/*! dds-app 28-11-2013 */
"use strict";angular.module("LocalStorageModule").value("prefix","dds_scholen"),angular.module("ddsApp.controllers",[]),angular.module("ddsApp.services",[]),angular.module("ddsApp.directives",[]);var app=angular.module("ddsApp",["ngRoute","ngResource","ddsApp.controllers","ddsApp.services","ddsApp.directives","LocalStorageModule"]).config(["$routeProvider","$locationProvider","$httpProvider",function($routeProvider,$locationProvider,$httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"],$routeProvider.when("/",{templateUrl:"views/main.html",controller:"ddsApp.controllers.MainCtrl"}),$routeProvider.when("/todo",{templateUrl:"views/todo.html",controller:"ddsApp.controllers.ToDoCtrl"}),$routeProvider.when("/basisscholen",{templateUrl:"views/basisscholen.html",controller:"ddsApp.controllers.BasisscholenCtrl",resolve:{basisscholen:appCtrl.getDataBasisscholen}}),$routeProvider.when("/basisscholen/:schoolId",{templateUrl:"views/basisschool.html",controller:"ddsApp.controllers.BasisschoolCtrl",resolve:{basisscholen:appCtrl.getDataBasisscholen}}),$routeProvider.when("/secundairescholen",{templateUrl:"views/secundairescholen.html",controller:"ddsApp.controllers.SecundairescholenCtrl",resolve:{secundairescholen:appCtrl.getDataSecundairescholen}}),$routeProvider.when("/favorieten",{templateUrl:"views/favorieten.html",controller:"ddsApp.controllers.FavorietenCtrl"}),$routeProvider.when("/about",{templateUrl:"views/about.html",controller:"ddsApp.controllers.AboutCtrl"}),$routeProvider.when("/app",{templateUrl:"views/app.html",controller:"AppCtrl",resolve:{appInitialized:appCtrl.loadData}}),$routeProvider.otherwise({redirectTo:"/"})}]).run(["$rootScope","$timeout","$location","ddsApp.services.ScholenSrvc",function($rootScope,$timeout,$location){$rootScope.appInitialized=!1,$rootScope.$on("$routeChangeStart",function(){$rootScope.appInitialized?$rootScope.appInitialized&&"/app"===$location.path()&&$location.path("/"):$location.path("/app")})}]),appCtrl=app.controller("AppCtrl",["$scope","$location","appInitialized",function($scope,$location,appInitialized){appInitialized&&$location.path("/")}]);appCtrl.loadData=["$rootScope","$q","$timeout","ddsApp.services.ScholenSrvc",function($rootScope,$q,$timeout,ScholenSrvc){var deferred=$q.defer();return ScholenSrvc.loadData().then(function(data){$timeout(function(){$rootScope.appInitialized=!0,deferred.resolve(data)},2e3)},function(error){deferred.reject(error)}),deferred.promise}],appCtrl.getAmountOfScholenPerType=["$q","ddsApp.services.ScholenSrvc",function(){}],appCtrl.getDataBasisscholen=["$q","ddsApp.services.ScholenSrvc",function($q,ScholenSrvc){var deferred=$q.defer();return ScholenSrvc.getDataBasisscholen().then(function(data){deferred.resolve(data)},function(error){deferred.reject(error)}),deferred.promise}],appCtrl.getDataSecundairescholen=["$q","ddsApp.services.ScholenSrvc",function($q,ScholenSrvc){var deferred=$q.defer();return ScholenSrvc.getDataSecundairescholen().then(function(data){deferred.resolve(data)},function(error){deferred.reject(error)}),deferred.promise}],function(){var directives=angular.module("ddsApp.directives");directives.directive("leafletmanyplaces",function($window){return{restrict:"E",transclude:!0,require:"^lflPlaces",scope:{lflPlaces:"=",lflRefresh:"="},link:function(scope,element){var schoolIcon=L.icon({iconUrl:"content/images/school_marker.png",iconRetinaUrl:"content/images/school_marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-37],shadowUrl:"content/images/school_marker.png",shadowRetinaUrl:"content/images/school_marker.png",shadowSize:[32,37],shadowAnchor:[16,37]});element.addClass("leaflet-holder"),scope.map=new L.Map(element[0],{scrollWheelZoom:!1}),scope.map.setView([51.053319,3.730274],14),scope.layer=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Map data © OpenStreetMap contributors"}).addTo(scope.map),scope.$watch("lflPlaces",function(newVal,oldVal){var val=oldVal;newVal&&(val=newVal),val&&(scope.map.setView(new L.LatLng(51.053319,3.730274),14),scope.markers&&angular.forEach(scope.markers,function(marker){scope.map.removeLayer(marker)}),scope.markers=[],angular.forEach(val,function(place){scope.markers.push(new L.marker(new L.LatLng(place.lat,place.lng),{icon:schoolIcon}).addTo(scope.map).bindPopup(place.dsc))}),L.Util.requestAnimFrame(scope.map.invalidateSize,scope.map,!1,scope.map._container))}),angular.element($window).bind("resize",function(){scope.$apply(),L.Util.requestAnimFrame(scope.map.invalidateSize,scope.map,!1,scope.map._container)}),scope.$watch("lflRefresh",function(){scope.map.invalidateSize(!1)}),scope.map.invalidateSize(!1),scope.$broadcast("mapAvailable",scope.map)}}}),directives.directive("lflPlaces",function(){return{controller:function(){}}}),directives.directive("lflRefresh",function(){return{controller:function(){}}})}(),function(){var directives=angular.module("ddsApp.directives");directives.directive("leafletoneplace",function(){return{restrict:"E",transclude:!0,require:"^lflPlace",scope:{lflPlace:"="},link:function(scope,element){var schoolIcon=L.icon({iconUrl:"content/images/school_marker.png",iconRetinaUrl:"content/images/school_marker.png",iconSize:[32,37],iconAnchor:[16,37],popupAnchor:[0,-37],shadowUrl:"content/images/school_marker.png",shadowRetinaUrl:"content/images/school_marker.png",shadowSize:[32,37],shadowAnchor:[16,37]});element.addClass("leaflet-holder"),scope.map=new L.Map(element[0],{scrollWheelZoom:!1}),new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Map data Â© OpenStreetMap contributors"}).addTo(scope.map),scope.$watch("lflPlace",function(oldVal,newVal){var val=oldVal;newVal&&(val=newVal),val&&(scope.map.setView(new L.LatLng(val.lat,val.lng),val.zoom||10),scope.marker=new L.marker(new L.LatLng(val.lat,val.lng),{icon:schoolIcon}).addTo(scope.map).bindPopup(val.dsc).openPopup())}),scope.$broadcast("mapAvailable",scope.map)}}}),directives.directive("lflPlace",function(){return{controller:function(){}}})}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.AboutCtrl",["$scope",function(){}])}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.BasisscholenCtrl",["$scope","$filter","ddsApp.services.ScholenSrvc","basisscholen",function($scope,$filter,ScholenSrvc,basisscholen){$scope.basisschooltypes=[{label:"-- Alle basisscholen --",value:""},{label:"Kleuterscholen",value:"Kleuter"},{label:"Lagere scholen",value:"Lager"},{label:"Buitengewoon onderwijs",value:"Buitengewoon"},{label:"Kunstonderwijs",value:"KO"}],$scope.form={basisschooltype:$scope.basisschooltypes[0]},$scope.$watch("form.basisschooltype",function(){if(null!==$scope.basisscholen){var filteredBasisscholen=$scope.basisscholen;""!==$scope.form.basisschooltype.value&&(filteredBasisscholen=$filter("filter")($scope.basisscholen,{aanbod:$scope.form.basisschooltype.value})),$("#info-message").html('<span class="badge pull-left">'+filteredBasisscholen.length+"</span> basisscholen");var lflPlaces=[];angular.forEach(filteredBasisscholen,function(basisschool){lflPlaces.push({lat:basisschool.lat,lng:basisschool.long,dsc:"<strong>"+basisschool.roepnaam+"</strong>"})}),$scope.lflplacesbasisscholen=lflPlaces,$scope.lflrefresh=!0}}),$scope.basisscholen=basisscholen,$("#info-message").html('<span class="badge pull-left">'+$scope.basisscholen.length+"</span> basisscholen");var lflPlaces=[];angular.forEach($scope.basisscholen,function(basisschool){lflPlaces.push({lat:basisschool.lat,lng:basisschool.long,dsc:"<strong>"+basisschool.roepnaam+"</strong>"})}),$scope.lflplacesbasisscholen=lflPlaces,$scope.lflrefresh=!0,$scope.isList=!0,$scope.changeIsList=function(isList){$scope.isList=isList,$scope.lflrefresh=!isList},$scope.isSchoolAFavorite=function(schoolId){return ScholenSrvc.isBasisschoolAlreadyFavorite(schoolId.toString())}}])}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.BasisschoolCtrl",["$scope","$routeParams","ddsApp.services.ScholenSrvc","basisscholen",function($scope,$routeParams,ScholenSrvc,basisscholen){var schoolId=$routeParams.schoolId;$scope.basisschool=_.find(basisscholen,{fid:schoolId}),$scope.lflplace={lat:$scope.basisschool.lat,lng:$scope.basisschool.long,dsc:"<strong>"+$scope.basisschool.roepnaam+"</strong>"},$scope.isSchoolAFavorite=ScholenSrvc.isBasisschoolAlreadyFavorite(schoolId),$scope.addSchoolToFavorites=function(){ScholenSrvc.isBasisschoolAlreadyFavorite(schoolId)||(ScholenSrvc.addBasisschoolToFavorites(schoolId),$scope.isSchoolAFavorite=!0)},$scope.removeSchoolFromFavorites=function(){ScholenSrvc.isBasisschoolAlreadyFavorite(schoolId)&&(ScholenSrvc.removeBasisschoolFromFavorites(schoolId),$scope.isSchoolAFavorite=!1)}}])}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.FavorietenCtrl",["$scope",function(){}])}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.HeaderCtrl",["$scope","$location","$rootScope",function($scope,$location,$rootScope){$rootScope.isRouteActive=function(route){return"/"===route?route===$location.path():-1!==$location.path().indexOf(route)}}])}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.MainCtrl",["$scope",function(){}])}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.SecundairescholenCtrl",["$scope","$filter","ddsApp.services.ScholenSrvc","secundairescholen",function($scope,$filter,ScholenSrvc,secundairescholen){$scope.gemeenten=[{label:"-- Alle deelgemeenten --",value:""},{label:"Gent",value:"GENT"},{label:"Ledeberg",value:"LEDEBERG"},{label:"Mariakerke",value:"MARIAKERKE"},{label:"Oostakker",value:"OOSTAKKER"},{label:"Sint-Amandsberg",value:"SINT-AMANDSBERG"},{label:"Sint-Denijs-Westrem",value:"SINT-DENIJS-WESTREM"},{label:"Zwijnaarde",value:"ZWIJNAARDE"}],$scope.form={gemeente:$scope.gemeenten[0]},$scope.$watch("form.gemeente",function(){if(null!==$scope.secundairescholen){var filteredSecundairescholen=$scope.secundairescholen;""!==$scope.form.gemeente.value&&(filteredSecundairescholen=$filter("filter")($scope.secundairescholen,{gemeente:$scope.form.gemeente.value})),$("#info-message").html('<span class="badge pull-left">'+filteredSecundairescholen.length+"</span> secundaire scholen");var lflPlaces=[];angular.forEach(filteredSecundairescholen,function(secundaireschool){lflPlaces.push({lat:secundaireschool.lat,lng:secundaireschool.long,dsc:"<strong>"+secundaireschool.naam+"</strong>"})}),$scope.lflplacessecundairescholen=lflPlaces,$scope.lflrefresh=!0}}),$scope.secundairescholen=secundairescholen,$("#info-message").html('<span class="badge pull-left">'+$scope.secundairescholen.length+"</span> secundaire scholen");var lflPlaces=[];angular.forEach($scope.secundairescholen,function(secundaireschool){lflPlaces.push({lat:secundaireschool.lat,lng:secundaireschool.long,dsc:"<strong>"+secundaireschool.naam+"</strong>"})}),$scope.lflplacessecundairescholen=lflPlaces,$scope.lflrefresh=!0,$scope.isList=!0,$scope.changeIsList=function(isList){$scope.isList=isList,$scope.lflrefresh=!isList}}])}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.ToDoCtrl",["$scope",function($scope){$scope.items=[{text:"pampers verversen",state:"completed"},{text:"scheren",state:"todo"},{text:"bower",state:"completed"}],$scope.addNewItem=function(){var newItem={text:$scope.itemText,state:"todo"};$scope.items.push(newItem),$scope.itemText=""},$scope.completeItem=function(item){switch(item.state){case"completed":item.state="todo";break;case"todo":item.state="completed";break;default:item.state="todo"}}}])}(),function(){var services=angular.module("ddsApp.services");services.factory("ddsApp.services.ScholenSrvc",["$rootScope","$http","$q","localStorageService",function($rootScope,$http,$q,localStorageService){var URLBASISSCHOLEN="http://data.appsforghent.be/poi/basisscholen.json?callback=JSON_CALLBACK",URLSECUNDAIRESCHOLEN="http://data.appsforghent.be/poi/secundairescholen.json?callback=JSON_CALLBACK",MSGBASISSCHOLENLOADERROR="Could not load the basischolen data from the requested URI.",MSGSECUNDAIRESCHOLENLOADERROR="Could not load the secundaire scholen data from the requested URI.",MSGSCHOLENLOADERROR="Could not load the basischolen and/or secundaire scholen data from the requested URI.",_basisscholen=null,_secundairescholen=null,_favosBasisscholen=null,_numberOfResourcesToLoadViaAJAX=2,_numberOfResourcesLoadedViaAJAX=0,that=this;return this.loadBasisscholen=function(){var deferred=$q.defer();return null===_basisscholen?null===localStorageService.get("basisscholen")?$http.jsonp(URLBASISSCHOLEN).success(function(data){_basisscholen=data.basisscholen,localStorageService.set("basisscholen",_basisscholen),deferred.resolve(_basisscholen)}).error(function(){deferred.reject(MSGBASISSCHOLENLOADERROR)}):(_basisscholen=localStorageService.get("basisscholen"),deferred.resolve(_basisscholen)):deferred.resolve(_basisscholen),deferred.promise},this.loadSecundairescholen=function(){var deferred=$q.defer();return null===_secundairescholen?null===localStorageService.get("secundairescholen")?$http.jsonp(URLSECUNDAIRESCHOLEN).success(function(data){_secundairescholen=data.secundairescholen,localStorageService.set("secundairescholen",_secundairescholen),deferred.resolve(_secundairescholen)}).error(function(){deferred.reject(MSGSECUNDAIRESCHOLENLOADERROR)}):(_secundairescholen=localStorageService.get("secundairescholen"),deferred.resolve(_secundairescholen)):deferred.resolve(_secundairescholen),deferred.promise},{loadData:function(){var deferred=$q.defer();return that.loadBasisscholen().then(function(){_numberOfResourcesLoadedViaAJAX++,_numberOfResourcesLoadedViaAJAX===_numberOfResourcesToLoadViaAJAX&&deferred.resolve(!0)},function(){deferred.reject(MSGSCHOLENLOADERROR)}),that.loadSecundairescholen().then(function(){_numberOfResourcesLoadedViaAJAX++,_numberOfResourcesLoadedViaAJAX===_numberOfResourcesToLoadViaAJAX&&deferred.resolve(!0)},function(){deferred.reject(MSGSCHOLENLOADERROR)}),deferred.promise},getDataBasisscholen:function(){var deferred=$q.defer();return null===_basisscholen?deferred.reject(MSGBASISSCHOLENLOADERROR):deferred.resolve(_basisscholen),deferred.promise},getDataSecundairescholen:function(){var deferred=$q.defer();return null===_secundairescholen?deferred.reject(MSGSECUNDAIRESCHOLENLOADERROR):deferred.resolve(_secundairescholen),deferred.promise},isBasisschoolAlreadyFavorite:function(schoolId){if(null===localStorageService.get("basisscholenfavorites"))return!1;var favos=localStorageService.get("basisscholenfavorites"),school=_.find(favos,function(sId){return sId===schoolId});return"undefined"==typeof school?!1:!0},addBasisschoolToFavorites:function(schoolId){this.isBasisschoolAlreadyFavorite(schoolId)||(_favosBasisscholen=localStorageService.get("basisscholenfavorites"),null===_favosBasisscholen&&(_favosBasisscholen=[]),_favosBasisscholen.push(schoolId),localStorageService.set("basisscholenfavorites",_favosBasisscholen))},removeBasisschoolFromFavorites:function(schoolId){this.isBasisschoolAlreadyFavorite(schoolId)&&(_favosBasisscholen=localStorageService.get("basisscholenfavorites"),null!==_favosBasisscholen&&(_favosBasisscholen=_.pull(_favosBasisscholen,schoolId),localStorageService.set("basisscholenfavorites",_favosBasisscholen)))}}}])}();